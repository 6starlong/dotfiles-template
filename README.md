# PowerShell Dotfiles ç®¡ç†å·¥å…·

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è·¨å¹³å° dotfiles ç®¡ç†å·¥å…·ï¼ŒåŸºäº PowerShell æ„å»ºï¼Œæä¾›æ™ºèƒ½é…ç½®éƒ¨ç½²ã€æ¨¡æ¿è½¬æ¢ã€è‡ªåŠ¨å¤‡ä»½å’Œåˆ†å±‚é…ç½®ç®¡ç†ï¼Œå®æ—¶åŒæ­¥ä½ çš„å¼€å‘ç¯å¢ƒé…ç½®ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

- **âœ… é…ç½®çŠ¶æ€æ£€æŸ¥**: å®æ—¶æ£€æŸ¥æ¯ä¸ªé…ç½®çš„åŒæ­¥çŠ¶æ€ (å·²åŒæ­¥ã€æœªåŒæ­¥ã€æœªéƒ¨ç½²ç­‰)
- **âš™ï¸ çµæ´»éƒ¨ç½²æ–¹å¼**: æ”¯æŒæ–‡ä»¶å¤åˆ¶ `Copy` åŠæ–‡ä»¶/ç›®å½•ç¬¦å·é“¾æ¥ `SymLink` å¤šç§éƒ¨ç½²æ¨¡å¼
- **ğŸ›¡ï¸ è‡ªåŠ¨å¤‡ä»½**: å®‰è£…å‰è‡ªåŠ¨å¤‡ä»½ç°æœ‰é…ç½®ï¼Œå¹¶æ”¯æŒäº¤äº’å¼åœ°åˆ›å»ºã€æ¢å¤å’Œæ¸…ç†å¤‡ä»½
- **ğŸš€ æ™ºèƒ½ JSON è½¬æ¢**: æ”¯æŒ JSONCã€æ·±åº¦åˆå¹¶åŠå­—æ®µæ˜ å°„å®ç°é«˜çº§é…ç½®ç®¡ç†
- **ğŸ’» è·¨å¹³å°åˆ†å±‚é…ç½®**: å…¼å®¹ Windows/macOS/Linuxï¼Œé€šè¿‡å åŠ æ–‡ä»¶ç®¡ç†å·®å¼‚
- **ğŸš« çµæ´»å¿½ç•¥æœºåˆ¶**: ä½¿ç”¨ç±»ä¼¼ `.gitignore` çš„è¯­æ³•æ§åˆ¶éƒ¨ç½²
- **ğŸ”’ Windows è‡ªåŠ¨ææƒ**: è‡ªåŠ¨è¯·æ±‚ç®¡ç†å‘˜æƒé™ç®€åŒ–ç¬¦å·é“¾æ¥åˆ›å»º

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å…‹éš†é¡¹ç›®**:

    ```shell
    git clone https://github.com/6starlong/dotfiles-template.git dotfiles
    cd dotfiles
    ```

2. **è‡ªå®šä¹‰é…ç½®**:
    - å°†ä½ çš„é…ç½®æ–‡ä»¶æ”¾å…¥ `configs/` ç›®å½•ã€‚
    - æ‰“å¼€ `config.psd1` å¹¶æ ¹æ®ä½ çš„éœ€æ±‚æ·»åŠ æ¡ç›®ï¼š
      - **å¦‚éœ€éƒ¨ç½²æ–‡ä»¶/ç›®å½•**: åœ¨ `Links` åˆ—è¡¨ä¸­ä¸ºå…¶åˆ›å»ºé“¾æ¥ã€‚
      - **å¦‚éœ€ä»æ¨¡æ¿ç”Ÿæˆæ–‡ä»¶**: åœ¨ `Transforms` åˆ—è¡¨ä¸­ä¸ºå…¶åˆ›å»ºç”Ÿæˆä»»åŠ¡ã€‚

3. **è¿è¡Œå®‰è£…**:

    ```shell
    .\setup.cmd
    # or run
    # ./setup.sh
    ```

## ğŸ“ é¡¹ç›®ç»“æ„

```text
dotfiles/
â”œâ”€â”€ backups/              # è‡ªåŠ¨å¤‡ä»½ (è¢« git å¿½ç•¥)
â”œâ”€â”€ bin/                  # æ ¸å¿ƒç®¡ç†è„šæœ¬
â”œâ”€â”€ configs/              # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ git/              # Git é…ç½®
â”‚   â”œâ”€â”€ vscode/           # VS Code é…ç½®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ lib/                  # å…±äº«æ¨¡å—
â”œâ”€â”€ scripts/              # è¾…åŠ©è„šæœ¬
â”‚   â””â”€â”€ transform.ps1     # è½¬æ¢å·¥å…·
â”œâ”€â”€ templates/            # é…ç½®ç”Ÿæˆæ¨¡æ¿
â”‚   â”œâ”€â”€ editors/          # ç¼–è¾‘å™¨æ¨¡æ¿
â”‚   â””â”€â”€ ...
â”œâ”€â”€ config.psd1           # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md             # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ setup.cmd             # Windows å¯åŠ¨è„šæœ¬
â””â”€â”€ setup.sh              # macOS/Linux å¯åŠ¨è„šæœ¬
```

## âš™ï¸ æ ¸å¿ƒå·¥ä½œæµ

ä½¿ç”¨**éƒ¨ç½²**å’Œ**ç”Ÿæˆ**è¿™ä¸¤ç§æ–¹å¼æ¥ç®¡ç†ä½ çš„é…ç½®æ–‡ä»¶ã€‚

### éƒ¨ç½²é“¾æ¥ (Deployment Links)

ç”¨äºå°†ä»“åº“ä¸­çš„æ–‡ä»¶æˆ–ç›®å½•éƒ¨ç½²åˆ°ä½ çš„æ“ä½œç³»ç»Ÿä¸­ï¼ˆé€šè¿‡ç¬¦å·é“¾æ¥æˆ–å¤åˆ¶ï¼‰ã€‚

- **é…ç½®æ–‡ä»¶**: `config.psd1` -> `Links` åˆ—è¡¨
- **é€‚ç”¨åœºæ™¯**: ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼ˆ`~/.gitconfig`ï¼‰æˆ–åŒæ­¥æ•´ä¸ªç›®å½•çš„é…ç½®ï¼ˆ`~/.claude/`ï¼‰ã€‚

**æ³¨æ„**ï¼šç›®å½•ç±»å‹çš„é“¾æ¥ä»…æ”¯æŒ `SymLink` æ–¹å¼ã€‚è¯·ç¡®ä¿ç›®æ ‡è·¯å¾„æ˜¯ä¸€ä¸ªä¸å­˜åœ¨æˆ–ä¸ºç©ºçš„ç›®å½•ï¼Œä¸”ä¸è¦å°†å…¶æŒ‡å‘å·²æœ‰é‡è¦æ–‡ä»¶æˆ–éç‹¬ç«‹çš„é…ç½®ç›®å½•ï¼Œä»¥é¿å…æ•°æ®ä¸¢å¤±æˆ–è¦†ç›–ã€‚

```powershell
# åœ¨ config.psd1 ä¸­
@Links = @(
    # é“¾æ¥å•ä¸ªæ–‡ä»¶
    @{
        Source    = "configs\git\.gitconfig"
        Target    = "{USERPROFILE}\.gitconfig"
        Comment   = "Git å…¨å±€é…ç½®"
        Method    = "SymLink" # æˆ– "Copy"
    },
    # é“¾æ¥æ•´ä¸ªç›®å½•
    @{
        Source    = "configs\claude"
        Target    = "{USERPROFILE}\.claude"
        Comment   = "Claude Code é…ç½®æ–‡ä»¶"
        Method    = "SymLink"
    }
)
```

**å®‰è£…**: åŒå‡»å¯åŠ¨ `setup.cmd` æˆ–è¿è¡Œ `./setup.sh`ã€‚

### ç”Ÿæˆé…ç½®æ–‡ä»¶ (Generating Config Files)

ç”¨äºä»æ¨¡æ¿ (`.\templates\`) ç”Ÿæˆå˜ä½“çš„å¤æ‚ JSON é…ç½®ï¼Œåœ¨ä¸åŒå¹³å°æˆ–åº”ç”¨ä¸­ä½¿ç”¨ã€‚

- **é…ç½®æ–‡ä»¶**: `config.psd1` -> `Transforms` åˆ—è¡¨
- **é€‚ç”¨åœºæ™¯**: éœ€è¦å­—æ®µæ˜ å°„ï¼ˆé”®åä¸åŒä½†å€¼ç›¸åŒï¼‰æˆ–åˆ†å±‚é…ç½®ï¼ˆå…±äº«åŸºç¡€é…ç½®ï¼Œä½†å„æœ‰ä¸åŒï¼‰çš„ JSON é…ç½®ã€‚

#### 1. å­—æ®µæ˜ å°„ (FieldMapping)

```powershell
# åœ¨ config.psd1 ä¸­
TransformSettings = @{
    "mcp" = @{
        SourceFile   = "templates\mcp\servers.json"
        DefaultField = "mcpServers"
        Platforms    = @{ vscode = "servers" }
    }
}

Transforms = @(
    # å®šä¹‰ä¸€ä¸ª "mcp:vscode" ç±»å‹çš„è½¬æ¢ä»»åŠ¡
    @{
        Type    = "mcp:vscode"
        Target  = "configs\vscode\mcp.json" # è¿™æ˜¯ç”Ÿæˆæ–‡ä»¶çš„å­˜æ”¾è·¯å¾„
        Comment = "VS Code MCP Servers"
    }
)
```

- **ä½¿ç”¨**: è¿è¡Œ `.\scripts\transform.ps1 -Type mcp:vscode` å³å¯ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚

#### 2. åˆ†å±‚é…ç½® (Layered)

```powershell
# åœ¨ config.psd1 ä¸­
TransformSettings = @{
    "editor" = @{
        SourceFile = "templates\editors\settings.base.json"
        Layered    = @{
            "vscode" = @("templates\editors\settings.vscode.json")
            "cursor" = @("templates\editors\settings.cursor.json")
        }
    }
}
Transforms = @(
    @{
        Type    = "editor:vscode"
        Target  = "configs\vscode\settings.json"
        Comment = "VS Code Settings"
    }
    @{
        Type    = "editor:cursor"
        Target  = "configs\cursor\settings.json"
        Comment = "Cursor Settings"
    }
)
```

- **ä½¿ç”¨**: è¿è¡Œ `.\scripts\transform.ps1 -T editor` æ¥ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚
- **æç¤º**: ä½ è¿˜å¯ä»¥åœ¨ä»»ä½•å±‚çº§çš„æ–‡ä»¶ä¸­ä½¿ç”¨ `$excludeFields` æ•°ç»„æ¥ç§»é™¤é¡¶å±‚å­—æ®µã€‚

## ğŸ“‹ ä½¿ç”¨æ–¹æ³•

### äº¤äº’å¼ç®¡ç†

```shell
.\setup.cmd
# or run
# ./setup.sh
```

### å‘½ä»¤è¡Œä½¿ç”¨

```shell
# å®‰è£…æ‰€æœ‰é…ç½®
.\bin\install.ps1

# åŒæ­¥é…ç½®
.\bin\sync.ps1

# æ£€æŸ¥çŠ¶æ€
.\bin\status.ps1

# åˆ›å»ºå¤‡ä»½
.\bin\backup.ps1

# å¸è½½æ‰€æœ‰é…ç½®
.\bin\uninstall.ps1

# ç”Ÿæˆé…ç½®æ–‡ä»¶
.\scripts\transform.ps1
```

## ğŸ”§ åŒ…å«çš„é…ç½®ç¤ºä¾‹

æœ¬æ¨¡æ¿é»˜è®¤åŒ…å«ä»¥ä¸‹å¸¸ç”¨é…ç½®ï¼Œä½ å¯ä»¥ç›´æ¥ä¿®æ”¹ä½¿ç”¨ï¼š

- **Git**:
  - `.gitconfig`: å…¨å±€ Git é…ç½®ã€‚
  - `.gitignore_global`: Git å…¨å±€å¿½ç•¥æ–‡ä»¶ã€‚
- **PowerShell**:
  - `Microsoft.PowerShell_profile.ps1`: PowerShell æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚
- **NPM**:
  - `.npmrc`: NPM é…ç½®æ–‡ä»¶ã€‚
- **SSH**:
  - `config`: SSH å®¢æˆ·ç«¯é…ç½®ï¼Œç”¨äºç®€åŒ–è¿œç¨‹è¿æ¥ã€‚
- **VS Code (é€šè¿‡æ¨¡æ¿ç”Ÿæˆ)**:
  - `settings.json`: ç¼–è¾‘å™¨è®¾ç½®ã€‚
  - `mcp.json`: MCP æœåŠ¡å™¨åˆ—è¡¨ã€‚
- **Zsh**:
  - `.zshrc`: Zsh æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚

## ğŸ”’ å¤„ç†æ•æ„Ÿæ•°æ®ä¸ç‰¹æ®Šæ–‡ä»¶

åŸåˆ™ï¼šä¸ºäº†ä¿è¯ä»“åº“çš„å®‰å…¨å’Œé€šç”¨æ€§ï¼Œè¯·**ä¸è¦**ç›´æ¥å‘ Git ä»“åº“æäº¤ä»»ä½•**å¯†é’¥**ã€**ä»¤ç‰Œ**æˆ–**ç§æœ‰ä¿¡æ¯**ã€‚

æ¨èä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ç®¡ç†è¿™äº›æ–‡ä»¶ï¼š

1. **ä½¿ç”¨æ¨¡æ¿**: å¯¹äºåŒ…å«æ•æ„Ÿä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ä»“åº“ä¸­åªä¿å­˜ä¸€ä¸ªå¸¦æœ‰å ä½ç¬¦çš„ `.template` ç‰ˆæœ¬ã€‚

    ```json
    // configs/app/config.template.json
    {
        "API_KEY": "YOUR_API_KEY"
    }
    ```

    ç„¶ååœ¨æœ¬åœ°åˆ›å»ºçœŸå®çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶è·¯å¾„æ·»åŠ åˆ° `.gitignore` ä¸­ã€‚

2. **ä½¿ç”¨ç¯å¢ƒå˜é‡**: åœ¨è„šæœ¬æˆ–é…ç½®ä¸­é€šè¿‡ `$env:API_KEY` å¼•ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç å€¼ã€‚

3. **ä½¿ç”¨ `IgnoreList`**: åœ¨ `config.psd1` ä¸­æ·»åŠ ä¸éœ€è¦éƒ¨ç½²çš„é…ç½®è·¯å¾„ï¼Œå®ç°å·®å¼‚åŒ–ç®¡ç†é…ç½®æ–‡ä»¶ã€‚

## ğŸ” å¸¸è§é—®é¢˜

**é…ç½®æœªç”Ÿæ•ˆ**ï¼š

- ç¡®ä¿ç›®æ ‡åº”ç”¨å·²å…³é—­
- æ£€æŸ¥ `config.psd1` ä¸­çš„æ–‡ä»¶è·¯å¾„
- ä½¿ç”¨ `.\bin\status.ps1` æ£€æŸ¥çŠ¶æ€

## ğŸ“„ è®¸å¯è¯

MIT License
